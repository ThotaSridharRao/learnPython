<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyTerminal - Python Learning Platform</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
   <style>
       /* Basic Reset */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Body and Global Styles */
body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #2d3748;
    line-height: 1.6;
}

/* Main Container - Single Column Layout */
.container {
    min-height: 100vh;
    max-width: 1200px;
    margin: 0 auto;
    background: #f7fafc;
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.1);
}

/* Header Styles */
.header {
    background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 40px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    position: relative;
    z-index: 10;
}

.header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
    backdrop-filter: blur(10px);
}

.logo {
    font-size: 28px;
    font-weight: 700;
    color: white;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    position: relative;
    z-index: 1;
}

.progress-info {
    display: flex;
    align-items: center;
    gap: 25px;
    font-size: 14px;
    color: white;
    position: relative;
    z-index: 1;
}

.level-badge {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    padding: 6px 12px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 12px;
    color: white;
    box-shadow: 0 2px 10px rgba(72, 187, 120, 0.3);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.progress-bar {
    width: 180px;
    height: 8px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    overflow: hidden;
    backdrop-filter: blur(10px);
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
    width: 2%;
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(72, 187, 120, 0.4);
}

/* Theory Panel - Now Full Width */
.theory-panel {
    background: white;
    padding: 40px;
    border-bottom: 1px solid #e2e8f0;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.02);
}

/* Practice Panel - Now Full Width */
.practice-panel {
    background: #f8fafc;
    display: flex;
    flex-direction: column;
    gap: 0;
}

.task-panel {
    background: white;
    padding: 40px;
    border-bottom: 1px solid #e2e8f0;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.02);
}

.code-area {
    background: white;
    padding: 40px;
    border-bottom: 1px solid #e2e8f0;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.02);
    position: relative; /* Added for positioning hint button inside */
}

.output-area {
    background: #1a202c;
    padding: 40px;
    color: #e2e8f0;
    min-height: 400px;
}

/* Section Titles */
.section-title {
    color: #2d3748;
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 30px;
    display: flex;
    align-items: center;
    gap: 12px;
    padding-bottom: 15px;
    border-bottom: 3px solid #4299e1;
    position: relative;
}

.section-title::before {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 0;
    width: 80px;
    height: 3px;
    background: linear-gradient(90deg, #4299e1 0%, #3182ce 100%);
}

/* Chapter Information Box */
.chapter-info {
    background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
    border: 1px solid #81e6d9;
    border-radius: 16px;
    padding: 30px;
    margin-bottom: 40px;
    position: relative;
    overflow: hidden;
}

.chapter-info::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.1) 100%);
    backdrop-filter: blur(10px);
}

.chapter-title {
    color: #234e52;
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 10px;
    position: relative;
    z-index: 1;
}

.chapter-subtitle {
    color: #2d3748;
    font-size: 16px;
    margin-bottom: 0;
    position: relative;
    z-index: 1;
    opacity: 0.8;
}

/* Theory Content Styling */
.theory-content {
    color: #4a5568;
    line-height: 1.8;
    font-size: 16px;
    max-width: none;
}

.theory-section {
    margin-bottom: 40px;
}

.theory-section h3 {
    color: #2d3748;
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.theory-content ul {
    padding-left: 25px;
}

.theory-content li {
    margin-bottom: 12px;
    position: relative;
}

.theory-content li::marker {
    color: #4299e1;
}

.code-example {
    background: #1a202c;
    border: 1px solid #2d3748;
    border-radius: 12px;
    padding: 25px;
    margin: 20px 0;
    color: #e2e8f0;
    font-family: 'Fira Code', 'Consolas', monospace;
    font-size: 14px;
    white-space: pre-wrap;
    position: relative;
    overflow-x: auto;
}

.code-example::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #4299e1 0%, #3182ce 100%);
}

.important-note {
    background: linear-gradient(135deg, #fef5e7 0%, #fed7aa 100%);
    border: 1px solid #f6ad55;
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
    color: #744210;
    font-size: 15px;
    position: relative;
}

.important-note::before {
    content: '⚠️';
    position: absolute;
    top: 20px;
    left: 20px;
    font-size: 18px;
}

.important-note div {
    margin-left: 35px;
}

/* Task Box Styling */
.task-box {
    background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);
    border: 1px solid #90cdf4;
    border-radius: 16px;
    padding: 30px;
    margin: 30px 0;
    position: relative;
    overflow: hidden;
}

.task-box::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.1) 100%);
    backdrop-filter: blur(10px);
}

.task-title {
    color: #2c5282;
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 15px;
    position: relative;
    z-index: 1;
}

.task-objective {
    color: #2d3748;
    margin-bottom: 20px;
    line-height: 1.7;
    position: relative;
    z-index: 1;
    font-size: 16px;
}

.expected-output {
    background: #1a202c;
    border: 1px solid #2d3748;
    border-radius: 8px;
    padding: 20px;
    margin: 15px 0;
    color: #48bb78;
    font-family: 'Fira Code', 'Consolas', monospace;
    font-size: 14px;
    position: relative;
    z-index: 1;
}

/* Code Input Area */
.code-input {
    width: 100%;
    height: 200px;
    background: #1a202c;
    border: 2px solid #2d3748;
    border-radius: 12px;
    color: #e2e8f0;
    padding: 20px;
    font-family: 'Fira Code', 'Consolas', monospace;
    font-size: 14px;
    resize: vertical;
    outline: none;
    transition: border-color 0.3s ease;
    line-height: 1.6;
    min-height: 150px;
}

.code-input:focus {
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

.code-input::placeholder {
    color: #718096;
}

/* Button Group */
.button-group {
    display: flex;
    gap: 15px;
    margin-top: 20px;
    flex-wrap: wrap;
}

/* General Button Styles */
.btn {
    background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
    color: white;
    border: none;
    padding: 15px 25px;
    border-radius: 12px;
    cursor: pointer;
    font-family: inherit;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    min-height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    box-shadow: 0 4px 15px rgba(66, 153, 225, 0.3);
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
}

.btn:hover::before {
    left: 100%;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(66, 153, 225, 0.4);
}

.btn:active {
    transform: translateY(0);
}

.btn:disabled {
    background: #cbd5e0;
    color: #a0aec0;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.btn:disabled::before {
    display: none;
}

.btn-primary {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
}

.btn-primary:hover {
    box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
}

.btn-success {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
}

.btn-navigation {
    background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%);
    color: white;
    min-width: 150px;
    box-shadow: 0 4px 15px rgba(128, 90, 213, 0.3);
}

.btn-navigation:hover {
    box-shadow: 0 6px 20px rgba(128, 90, 213, 0.4);
}

.btn-navigation:disabled {
    background: #cbd5e0;
    color: #a0aec0;
    box-shadow: none;
}

/* Output Console Styling */
.output-container {
    height: 100%;
    display: flex;
    flex-direction: column;
}

.output-header {
    color: #e2e8f0;
    margin-bottom: 20px;
    font-size: 20px;
    font-weight: 600;
    border-bottom: 2px solid #2d3748;
    padding-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.output-terminal {
    flex: 1;
    background: #000;
    border: 1px solid #2d3748;
    border-radius: 12px;
    padding: 25px;
    overflow-y: auto;
    font-size: 14px;
    line-height: 1.6;
    white-space: pre-wrap;
    font-family: 'Fira Code', 'Consolas', monospace;
    box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
    min-height: 250px;
}

.output-line {
    margin-bottom: 10px;
}

/* Output Text Colors */
.success-text {
    color: #48bb78;
}

.error-text {
    color: #f56565;
}

.info-text {
    color: #63b3ed;
}

/* Hint Section */
.hint-section {
    background: linear-gradient(135deg, #fef5e7 0%, #fed7aa 100%);
    border: 1px solid #f6ad55;
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
    display: none;
}

.hint-title {
    color: #744210;
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 15px;
}

/* Navigation */
.navigation {
    display: flex;
    justify-content:space-between;
    align-items: center;
    margin-top: 30px;
    padding-top: 25px;
    border-top: 1px solid #e2e8f0;
}

.nav-info {
    color: #718096;
    font-size: 14px;
}

.lesson-navigation {
    display: flex;
    gap: 20px;
    /* Removed top margin and padding to fit better at the top of theory panel */
    margin-top: 0; /* Adjusted for new position */
    padding: 20px 0; /* Retained horizontal padding */
    align-items: center;
    justify-content: center;
    border-bottom: 1px solid #e2e8f0; /* Added bottom border for separation */
    margin-bottom: 30px; /* Space between nav and chapter info */
}

.lesson-info {
    background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
    border: 1px solid #81e6d9;
    border-radius: 25px;
    padding: 15px 25px;
    color: #234e52;
    font-size: 25px;
    font-weight: 600;
    min-width: 140px;
    text-align: center;
    flex-shrink: 0;
    box-shadow: 0 4px 15px rgba(129, 230, 217, 0.3);
}

/* Floating Hint System - Now positioned within code-area */
.floating-hint-container {
    position: absolute; /* Changed from fixed to absolute */
    top: 20px; /* Adjusted position relative to code-area padding */
    right: 20px; /* Adjusted position relative to code-area padding */
    z-index: 1000;
}

.floating-hint-btn {
    background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
    color: white;
    border: none;
    padding: 18px 25px;
    border-radius: 50px;
    cursor: pointer;
    font-family: inherit;
    font-size: 14px;
    font-weight: 600;
    box-shadow: 0 6px 20px rgba(246, 173, 85, 0.4);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 10px;
    position: relative;
    overflow: hidden;
}

.floating-hint-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s;
}

.floating-hint-btn:hover::before {
    left: 100%;
}

.floating-hint-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(246, 173, 85, 0.5);
}

.floating-hint-panel {
    position: absolute;
    top: 80px; /* Adjusted position relative to the button */
    right: 0;
    width: 400px;
    max-width: 90vw;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 16px;
    padding: 30px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    transform: translateX(100%);
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    max-height: 500px;
    overflow-y: auto;
    backdrop-filter: blur(10px);
}

.floating-hint-panel.show {
    transform: translateX(0);
    opacity: 1;
    visibility: visible;
}

.floating-hint-panel .hint-title {
    color: #2d3748;
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.floating-hint-panel .hint-content {
    color: #4a5568;
    font-size: 15px;
    line-height: 1.7;
}

.floating-hint-panel ul {
    margin: 0;
    padding-left: 25px;
}

.floating-hint-panel li {
    margin-bottom: 12px;
    position: relative;
}

.floating-hint-panel li::marker {
    color: #4299e1;
}

.hint-close-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;
    color: #718096;
    font-size: 24px;
    cursor: pointer;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
}

.hint-close-btn:hover {
    background: #f7fafc;
    color: #2d3748;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 12px;
}

::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 6px;
}

::-webkit-scrollbar-thumb {
    background: #cbd5e0;
    border-radius: 6px;
    transition: background 0.3s ease;
}

::-webkit-scrollbar-thumb:hover {
    background: #a0aec0;
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        margin: 0;
        box-shadow: none;
    }

    .header {
        flex-direction: column;
        padding: 20px;
        gap: 15px;
    }

    .progress-info {
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
    }

    .theory-panel,
    .task-panel,
    .code-area,
    .output-area {
        padding: 25px;
    }

    .section-title {
        font-size: 20px;
    }

    .chapter-title {
        font-size: 24px;
    }

    .button-group {
        flex-direction: column;
    }

    .btn {
        width: 100%;
    }

    .lesson-navigation {
        flex-direction: column;
        gap: 15px;
    }

    .lesson-info,
    .btn-navigation {
        width: 100%;
        min-width: unset;
    }

    .floating-hint-container {
        top: auto;
        bottom: 30px;
        right: 20px;
        /* Revert to fixed for small screens if it makes more sense */
        position: fixed; /* Consider keeping it fixed for better mobile UX */
    }

    .floating-hint-panel {
        top: auto;
        bottom: 80px;
        right: 0;
        width: 90vw;
    }

    .code-input {
        height: 150px;
    }
}

@media (max-width: 480px) {
    .logo {
        font-size: 24px;
    }

    .progress-info {
        font-size: 12px;
    }

    .btn,
    .btn-navigation {
        padding: 12px 20px;
        font-size: 12px;
        min-height: 44px;
    }

    .theory-panel,
    .task-panel,
    .code-area,
    .output-area {
        padding: 20px;
    }

    .section-title {
        font-size: 18px;
    }

    .chapter-title {
        font-size: 20px;
    }

    .progress-bar {
        width: 120px;
    }
}

/* Animation keyframes */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* Add subtle animations */
.chapter-info,
.task-box,
.code-example,
.important-note {
    animation: fadeInUp 0.6s ease-out;
}

.theory-section {
    animation: slideIn 0.4s ease-out;
}

.floating-hint-btn {
    animation: pulse 3s infinite;
}

.floating-hint-btn:hover {
    animation: none;
}

/* Smooth scrolling for the entire page */
html {
    scroll-behavior: smooth;
}
/* Lesson Loader Overlay */
.lesson-loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.lesson-loader.show {
    opacity: 1;
    visibility: visible;
}

.loader-content {
    background: white;
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    transform: scale(0.8);
    transition: transform 0.3s ease;
}

.lesson-loader.show .loader-content {
    transform: scale(1);
}

.loader-icon {
    font-size: 48px;
    margin-bottom: 20px;
    animation: bounce 1s infinite;
}

.loader-title {
    font-size: 24px;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 10px;
}

.loader-subtitle {
    font-size: 16px;
    color: #718096;
    margin-bottom: 20px;
}

.loader-progress {
    width: 100%;
    height: 4px;
    background: #e2e8f0;
    border-radius: 2px;
    overflow: hidden;
    margin-top: 20px;
}

.loader-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #4299e1 0%, #3182ce 100%);
    width: 0%;
    transition: width 2s ease;
    border-radius: 2px;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
    }
    40% {
        transform: translateY(-10px);
    }
    60% {
        transform: translateY(-5px);
    }
}
/* Sidebar Styles */
.sidebar {
    position: fixed;
    top: 0;
    left: -350px;
    width: 350px;
    height: 100vh;
    background: white;
    box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow-y: auto;
    border-right: 1px solid #e2e8f0;
}

.sidebar.open {
    left: 0;
}

.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.sidebar-overlay.active {
    opacity: 1;
    visibility: visible;
}

.sidebar-header {
    padding: 30px 25px;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
    color: white;
}

.sidebar-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
}

.sidebar-close {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.2s ease;
}

.sidebar-close:hover {
    background: rgba(255, 255, 255, 0.2);
}

.sidebar-content {
    padding: 20px 0;
}

.chapter-item {
    margin-bottom: 5px;
}

.chapter-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px 25px;
    cursor: pointer;
    transition: background 0.2s ease;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    font-size: 16px;
    font-weight: 600;
    color: #2d3748;
}

.chapter-header:hover {
    background: #f7fafc;
}

.chapter-header.active {
    background: #ebf8ff;
    color: #2c5282;
    border-right: 3px solid #4299e1;
}

.chapter-arrow {
    font-size: 12px;
    transition: transform 0.2s ease;
}

.chapter-header.expanded .chapter-arrow {
    transform: rotate(90deg);
}

.lessons-list {
    display: none;
    background: #f8fafc;
    border-top: 1px solid #e2e8f0;
}

.lessons-list.expanded {
    display: block;
}

.lesson-item {
    display: block;
    padding: 12px 25px 12px 45px;
    color: #4a5568;
    text-decoration: none;
    font-size: 14px;
    transition: all 0.2s ease;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    cursor: pointer;
}

.lesson-item:hover {
    background: #e2e8f0;
    color: #2d3748;
}

.lesson-item.active {
    background: #4299e1;
    color: white;
    font-weight: 600;
}

.lesson-item.completed {
    position: relative;
}

.lesson-item.completed::after {
    content: '✓';
    position: absolute;
    right: 20px;
    color: #48bb78;
    font-weight: bold;
}

/* Sidebar Toggle Button */
.sidebar-toggle {
    position: fixed;
    top: 90px;
    left: 20px;
    z-index: 1001;
    background: rgba(21, 113, 184, 0.87);
    border: none;
    border-radius: 8px;
    width: 50px;
    height: 50px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    box-shadow: 0 4px 15px rgba(66, 153, 225, 0.3);
    transition: all 0.3s ease;
}

.sidebar-toggle:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(66, 153, 225, 0.4);
}

.hamburger-line {
    width: 20px;
    height: 2px;
    background: white;
    transition: all 0.3s ease;
}

.sidebar-toggle.active .hamburger-line:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
}

.sidebar-toggle.active .hamburger-line:nth-child(2) {
    opacity: 0;
}

.sidebar-toggle.active .hamburger-line:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -6px);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .sidebar {
        width: 300px;
        left: -300px;
    }
    
    .sidebar-toggle {
        top: 15px;
        left: 15px;
        width: 45px;
        height: 45px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar Navigation -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>📚 Course Navigation</h3>
                <button class="sidebar-close" id="sidebarClose">×</button>
            </div>
            <div class="sidebar-content" id="sidebarContent">
                <!-- Navigation will be populated by JavaScript -->
            </div>
        </div>

        <!-- Sidebar Toggle Button -->
        <button class="sidebar-toggle" id="sidebarToggle">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>

        <!-- Lesson Loader -->
        <div class="lesson-loader" id="lessonLoader">
            <div class="loader-content">
                <div class="loader-icon">📚</div>
                <div class="loader-title" id="loaderTitle">Loading Lesson...</div>
                <div class="loader-subtitle" id="loaderSubtitle">Please wait while we prepare your next lesson</div>
                <div class="loader-progress">
                    <div class="loader-progress-bar" id="loaderProgressBar"></div>
                </div>
            </div>
        </div>

        <div class="header">
            <div class="logo">🐍 PyTerminal - Learn Python</div>
            <div class="progress-info">
                <span id="chapterInfo">Chapter 1 of 10</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <span>Level: <span class="level-badge">Beginner</span></span>
            </div>
        </div>

        <div class="theory-panel">
            <!-- Lesson Navigation moved here -->
            <div class="lesson-navigation"> 
                <div class="lesson-info" id="lessonInfo">Lesson 1</div>
            </div>
            <div class="section-title">📚 Learning Material</div>
            <div id="lessonContainer"></div>
        </div>

        <div class="practice-panel">
            <!-- New Task Panel added here -->
            <div class="task-panel" id="taskPanel">
                <div class="section-title">🎯 Current Task</div>
                <!-- Task content will be rendered here by JavaScript -->
            </div>

            <div class="code-area">
                <div class="section-title">⌨️ Code Editor</div>
                <textarea class="code-input" id="codeInput" placeholder="# Write your Python code here
# Try: print('Hello, World!')"></textarea>
                <div class="button-group">
                    <button class="btn btn-primary" id="runBtn">▶️ Run Code</button>
                    <button class="btn" id="clearBtn">🗑️ Clear</button>
                </div>
                <!-- Floating Hint System moved inside code-area -->
                <div class="floating-hint-container">
                    <button class="floating-hint-btn" id="floatingHintBtn">
                        💡 <span id="hintBtnText">Show Hint</span>
                    </button>
                    <div class="floating-hint-panel" id="floatingHintPanel">
                        <button class="hint-close-btn" id="hintCloseBtn">×</button>
                        <div class="hint-title">💡 Helpful Hint</div>
                        <div class="hint-content" id="hintContent">
                            <p>No hints available for this lesson.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="output-area">
                <div class="output-container">
                    <div class="output-header">📟 Output Console</div>
                    <div class="output-terminal" id="outputTerminal">
<span class="info-text">Welcome to Python! 🐍

Ready to write your first program?
Type your code above and click 'Run Code' to see the magic happen!

Status: Waiting for your code...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state variables
        let currentChapter = 1;
        let currentLesson = 1;
        let pyodideReady = false;
        let pyodideInstance = null;
        let totalChapters = 10; // This should ideally come from exercises.json
        let maxLessonsPerChapter = {
            1: 4,  // Chapter 1 has 5 lessons
            2: 5,  // Chapter 2 has 6 lessons
            3: 4,  // Chapter 3 has 7 lessons
            4: 4,  // Chapter 4 has 8 lessons
            5: 5,  // Chapter 5 has 6 lessons
            6: 6,  // Chapter 6 has 7 lessons
            7: 5,  // Chapter 7 has 8 lessons
            8: 4,  // Chapter 8 has 9 lessons
            9: 4,  // Chapter 9 has 8 lessons
            10: 2 // Chapter 10 has 10 lessons
        };

        // DOM elements
        const runBtn = document.getElementById('runBtn');
        const clearBtn = document.getElementById('clearBtn');
        const floatingHintBtn = document.getElementById('floatingHintBtn');
        const floatingHintPanel = document.getElementById('floatingHintPanel');
        const hintCloseBtn = document.getElementById('hintCloseBtn');
        const hintBtnText = document.getElementById('hintBtnText');
        const hintContent = document.getElementById('hintContent');
        const codeInput = document.getElementById('codeInput');
        const outputTerminal = document.getElementById('outputTerminal');
        const chapterInfo = document.getElementById('chapterInfo');
        const lessonInfo = document.getElementById('lessonInfo');
        const lessonContainer = document.getElementById('lessonContainer'); // Added lessonContainer to DOM elements
        const taskPanel = document.getElementById('taskPanel'); // Added taskPanel to DOM elements
        const lessonLoader = document.getElementById('lessonLoader');

        /**
         * Shows the lesson loader with chapter and lesson information
         * @param {number} chapter - The chapter number
         * @param {number} lesson - The lesson number
         */
        function showLessonLoader(chapter, lesson) {
            const loader = document.getElementById('lessonLoader');
            const loaderTitle = document.getElementById('loaderTitle');
            const loaderSubtitle = document.getElementById('loaderSubtitle');
            const loaderProgressBar = document.getElementById('loaderProgressBar');
            
            // Update loader text
            loaderTitle.textContent = `Chapter ${chapter} - Lesson ${lesson}`;
            loaderSubtitle.textContent = `Preparing your learning materials...`;
            
            // Reset progress bar
            loaderProgressBar.style.width = '0%';
            
            // Show loader
            loader.classList.add('show');
            
            // Animate progress bar
            setTimeout(() => {
                loaderProgressBar.style.width = '100%';
            }, 100);
        }

        /**
         * Hides the lesson loader
         */
        function hideLessonLoader() {
            const loader = document.getElementById('lessonLoader');
            loader.classList.remove('show');
        }

        /**
         * Simulates loading delay with progress
         * @param {number} duration - Duration in milliseconds
         */
        function simulateLoading(duration = 2000) {
            return new Promise(resolve => {
                setTimeout(resolve, duration);
            });
        }

        /**
         * Initializes Pyodide, loading the Python environment.
         * Updates the output terminal with success or error messages.
         */
        async function setupPyodide() {
            try {
                pyodideInstance = await loadPyodide();
                pyodideReady = true;
                console.log("✅ Pyodide is ready");
                updateOutput("🐍 Python environment loaded and ready!", 'success');
            } catch (error) {
                console.error("❌ Failed to load Pyodide:", error);
                updateOutput("❌ Failed to load Python environment", 'error');
            }
        }

        /**
         * Updates the output terminal with a given message and type.
         * @param {string} message - The message to display.
         * @param {'info'|'success'|'error'} type - The type of message to determine styling.
         */
        function updateOutput(message, type = 'info') {
            let className = 'info-text';

            switch(type) {
                case 'error':
                    className = 'error-text';
                    break;
                case 'success':
                    className = 'success-text';
                    break;
                case 'info':
                default:
                    className = 'info-text';
                    break;
            }

            // Clear previous content and add new message
            outputTerminal.innerHTML = `<span class="${className}">${message}</span>`;
        }

        /**
         * Executes Python code using Pyodide and captures its output.
         * @param {string} code - The Python code to execute.
         * @returns {Promise<{success: boolean, output: string}>} - An object indicating success and the output/error.
         */
        async function executePython(code) {
            if (!pyodideReady) {
                return { success: false, output: "⏳ Pyodide is still loading... Please wait." };
            }

            try {
                // Temporarily redirect stdout to a StringIO object in Python
                await pyodideInstance.runPythonAsync(`
import sys
from io import StringIO
_captured_output = StringIO()
_old_stdout = sys.stdout
sys.stdout = _captured_output
`);

                // Run the user's code
                await pyodideInstance.runPythonAsync(code);

                // Get the captured output and restore stdout
                const output = await pyodideInstance.runPythonAsync(`
captured = _captured_output.getvalue()
sys.stdout = _old_stdout # Restore original stdout
captured
`);

                return {
                    success: true,
                    output: output || "✔ Code ran successfully (no output)"
                };
            } catch (err) {
                // Ensure stdout is restored even if an error occurs during code execution
                try {
                    await pyodideInstance.runPythonAsync(`
sys.stdout = _old_stdout # Restore original stdout
`);
                } catch (restoreErr) {
                    console.warn("Could not restore stdout after error:", restoreErr);
                }
                return { success: false, output: err.toString() };
            }
        }

        /**
         * Renders the lesson content into the theory panel and the task into the task panel.
         * @param {object} data - The lesson data containing title, theory, and task.
         */
        function renderLesson(data) {
            if (!lessonContainer) {
                console.error("❌ lessonContainer not found in DOM");
                return;
            }
            if (!taskPanel) {
                console.error("❌ taskPanel not found in DOM");
                return;
            }

            const { title, theory, task } = data;

            // Render theory content to the left panel
            lessonContainer.innerHTML = `
                <div class="chapter-info">
                    <div class="chapter-title">${title}</div>
                    <div class="chapter-subtitle">${theory.concept}</div>
                    <button class="btn btn-primary" id="voiceToggleBtn" onclick="toggleSpeech()">🔊 Listen to Explanation</button>
                </div>

                <div class="theory-section">
                    <h3>🧠 Introduction</h3>
                    <div class="theory-content">${theory.introduction}</div>
                </div>

                <div class="theory-section">
                    <h3>📖 Explanation</h3>
                    <div class="theory-content">${theory.explanation}</div>
                </div>

                <div class="theory-section">
                    <h3>💡 Key Points</h3>
                    <ul class="theory-content">
                        ${theory.keyPoints.map(point => `<li>${point}</li>`).join('')}
                    </ul>
                </div>

                <div class="theory-section">
                    <h3>💻 Code Examples</h3>
                    ${theory.codeExamples.map(example => `
                        <pre class="code-example">${example.code}</pre>
                        <p>${example.explanation}</p>
                    `).join('')}
                </div>

                <div class="important-note">
                    ${theory.importantNotes.map(note => `<div>${note}</div>`).join('')}
                </div>
            `;

            // Render task content to the new task panel (above code editor)
            taskPanel.innerHTML = `
                <div class="section-title">🎯 Current Task</div>
                <div class="task-box">
                    <div class="task-title">🧪 Task</div>
                    <div class="task-objective">${task.description}</div>
                    <div class="expected-output">
                        <strong>Expected Output:</strong><br>
                        ${task.expectedOutput}
                    </div>
                </div>
            `;


            // Update floating hint content
            updateHintContent(task.hints);
        }

        function toggleSpeech() {
            const btn = document.getElementById('voiceToggleBtn');

            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel(); // Stop current speech
                btn.textContent = '🔊 Listen to Explanation';
                return;
            }

            const data = window.lessonData;
            if (!data || !window.speechSynthesis) {
                alert("Speech data not available.");
                return;
            }

            const { theory, task } = data;
            const speechText = `
                ${data.title}.
                Concept: ${theory.concept}.
                Introduction: ${theory.introduction}.
                Explanation: ${theory.explanation}.
                Key points: ${theory.keyPoints.join(', ')}.
                Important notes: ${theory.importantNotes.join(', ')}.
                Task description: ${task.description}.
                Expected output: ${task.expectedOutput}.
            `;

            const utterance = new SpeechSynthesisUtterance(speechText);
            utterance.rate = 0.9;

            // 🔁 Ensure voices are loaded first (important for Chrome)
            const voices = speechSynthesis.getVoices();
            if (!voices.length) {
                speechSynthesis.onvoiceschanged = () => toggleSpeech(); // Retry once voices load
                return;
            }

            // ✅ Prefer Microsoft Heera or Google UK English Female
            const preferredVoice = voices.find(v =>
                v.name === "Microsoft Heera" ||
                v.name === "Google UK English Female"
            );

            if (preferredVoice) {
                utterance.voice = preferredVoice;
                utterance.lang = preferredVoice.lang;
            } else {
                console.warn("Preferred female Indian English voice not found. Using default voice.");
            }

            window.speechSynthesis.speak(utterance);
            btn.textContent = '🔇 Mute Voice';

            utterance.onend = () => {
                btn.textContent = '🔊 Listen to Explanation';
            };
        }






        /**
         * Updates the content of the floating hint panel.
         * @param {string[]} hints - An array of hint strings.
         */
        function updateHintContent(hints) {
            if (hints && hints.length > 0) {
                hintContent.innerHTML = `
                    <ul>
                        ${hints.map(hint => `<li>${hint}</li>`).join('')}
                    </ul>
                `;
            } else {
                hintContent.innerHTML = '<p>No hints available for this lesson.</p>';
            }
        }

        /**
         * Toggles the visibility of the floating hint panel.
         */
        function toggleHintPanel() {
            const isVisible = floatingHintPanel.classList.contains('show');

            if (isVisible) {
                floatingHintPanel.classList.remove('show');
                hintBtnText.textContent = 'Show Hint';
            } else {
                floatingHintPanel.classList.add('show');
                hintBtnText.textContent = 'Hide Hint';
            }
        }

        /**
         * Closes the floating hint panel.
         */
        function closeHintPanel() {
            floatingHintPanel.classList.remove('show');
            hintBtnText.textContent = 'Show Hint';
        }

        /**
         * Updates various UI elements like chapter info, lesson info, and progress bar.
         */
        function updateUI() {
            chapterInfo.textContent = `Chapter ${currentChapter} of ${totalChapters}`; // totalChapters is a placeholder
            lessonInfo.textContent = `Lesson ${currentChapter}.${currentLesson}`;


            // Update progress bar (rough estimation based on loaded lessons)
            // This calculation assumes maxLessonsPerChapter is populated.
            const totalLessons = Object.values(maxLessonsPerChapter).reduce((a, b) => a + b, 0) || 50; // Fallback to 50 if no data
            let completedLessons = 0;
            for (let i = 1; i < currentChapter; i++) {
                completedLessons += maxLessonsPerChapter[i] || 0;
            }
            completedLessons += (currentLesson - 1);

            const progress = Math.min((completedLessons / totalLessons) * 100, 100);
            document.getElementById('progressFill').style.width = `${progress}%`;

            // Update navigation buttons disable state
            prevBtn.disabled = (currentChapter === 1 && currentLesson === 1);
            // Next button is enabled unless we explicitly set it to disabled at the end of all lessons
            nextBtn.disabled = false;
            nextBtn.textContent = "Next ➡️"; // Reset text in case it was "Course Complete!"
        }

        /**
         * Fetches the number of lessons for a given chapter.
         * Caches the result in maxLessonsPerChapter.
         * @param {number} chapter - The chapter number.
         * @returns {Promise<number>} - The number of lessons in the chapter.
         */
        async function getLastLessonNumber(chapter) {
            if (maxLessonsPerChapter[chapter]) {
                return maxLessonsPerChapter[chapter];
            }

            try {
                // Attempt to load from a central exercises.json if it exists
                const res = await fetch('exercises.json');
                if (res.ok) {
                    const data = await res.json();
                    const chapterData = data.chapters.find(c => c.id === chapter);
                    const lessonCount = chapterData ? chapterData.lessons.length : 0;
                    maxLessonsPerChapter[chapter] = lessonCount;
                    return lessonCount;
                } else {
                    // Fallback to iterating through lesson files if exercises.json is not found
                    throw new Error("exercises.json not found, falling back to sequential loading.");
                }
            } catch (e) {
                console.warn("Failed to fetch exercises.json or chapter data:", e);
                // Fallback: try to load lessons sequentially by guessing filenames
                let lessonCount = 0;
                for (let i = 1; i <= 20; i++) { // Max 20 lessons per chapter for this fallback
                    try {
                        const response = await fetch(`exercises/chapter-${chapter}/lesson${i}.json`);
                        if (response.ok) {
                            lessonCount = i;
                        } else {
                            break; // Stop if a lesson file is not found
                        }
                    } catch (err) {
                        break; // Stop on network errors or other issues
                    }
                }
                maxLessonsPerChapter[chapter] = lessonCount;
                return lessonCount;
            }
        }

        /**
         * Loads a specific lesson by chapter and lesson number.
         * Renders the lesson content and updates the UI.
         * @param {number} chapter - The chapter number.
         * @param {number} lesson - The lesson number.
         * @returns {Promise<boolean>} - True if the lesson was loaded successfully, false otherwise.
         */
        async function loadLesson(chapter, lesson) {
            try {
                const response = await fetch(`exercises/chapter-${chapter}/lesson${lesson}.json`);
                if (!response.ok) {
                    // If lesson not found, it might be the end of the chapter
                    console.warn(`Lesson exercises/chapter-${chapter}/lesson${lesson}.json not found.`);
                    return false;
                }

                const data = await response.json();
                window.lessonData = data; // Make lesson data globally accessible if needed for validation
                renderLesson(data);
                updateUI();
                codeInput.value = data.task.initialCode || ``; // Set initial code
                return true;
            } catch (error) {
                console.error('Error loading lesson:', error);
                return false;
            }
        }

        /**
         * Navigates to the next lesson or chapter.
         */
        async function goToNextLesson() {
            const lastLessonInCurrentChapter = await getLastLessonNumber(currentChapter);
            let nextLesson = currentLesson + 1;
            let targetChapter = currentChapter;

            if (nextLesson > lastLessonInCurrentChapter) {
                // Move to next chapter
                targetChapter = currentChapter + 1;
                const nextChapterLessonCount = await getLastLessonNumber(targetChapter);

                if (nextChapterLessonCount > 0) {
                    nextLesson = 1; // Start from the first lesson of the new chapter
                } else {
                    // No more lessons in the next chapter, end of course
                    updateOutput("🏁 Congratulations! You've completed all lessons!", 'success');
                    nextBtn.textContent = "🎯 Go to Tasks";
                    nextBtn.onclick = function() {
                        window.location.href = 'tasks.html';
                    };
                    return;
                }
            }

            // Show loader with next lesson info
            showLessonLoader(targetChapter, nextLesson);
            
            // Simulate loading time
            await simulateLoading(1500);
            
            // Update variables BEFORE loading lesson
            currentChapter = targetChapter;
            currentLesson = nextLesson;

            const success = await loadLesson(targetChapter, nextLesson);
            
            // Hide loader
            hideLessonLoader();
            
            if (success) {
                updateOutput(`✅ Loaded Chapter ${currentChapter}, Lesson ${currentLesson}`, 'success');
            } else {
                // If loading next lesson fails, it means there are no more lessons
                updateOutput("🎉 All lessons completed! Ready for practice tasks?", 'success');
                nextBtn.textContent = "🎯 Go to Tasks";
                nextBtn.onclick = function() {
                    window.location.href = 'tasks.html';
                };
            }
        }

        /**
         * Navigates to the previous lesson or chapter.
         */
        async function goToPreviousLesson() {
            updateOutput("📦 Loading previous lesson...", 'info');

            let prevLesson = currentLesson - 1;
            let targetChapter = currentChapter;

            if (prevLesson < 1) {
                // Move to previous chapter
                targetChapter = currentChapter - 1;
                if (targetChapter < 1) {
                    updateOutput("⚠️ You're already at the first lesson!", 'error');
                    prevBtn.disabled = true; // Ensure prev button is disabled at the very beginning
                    return;
                }
                const prevChapterLessonCount = await getLastLessonNumber(targetChapter);
                prevLesson = prevChapterLessonCount; // Go to the last lesson of the previous chapter
            }

            // Update variables BEFORE loading lesson
            currentChapter = targetChapter;
            currentLesson = prevLesson;

            const success = await loadLesson(targetChapter, prevLesson);
            if (success) {
                updateOutput(`✅ Loaded Chapter ${currentChapter}, Lesson ${currentLesson}`, 'success');
            } else {
                updateOutput("⚠️ Could not load the previous lesson.", 'error');
            }
        }

        // Event Listeners
        runBtn.addEventListener('click', async function () {
            const code = codeInput.value.trim();
            if (!code) {
                updateOutput("Please write some code first!", 'error');
                return;
            }

            updateOutput("⏳ Executing code...", 'info');
            const result = await executePython(code);

            if (result.success) {
                updateOutput(`🟢 Output:\n${result.output}`, 'success');
            } else {
                updateOutput(`🔴 Error:\n${result.output}`, 'error');
            }
        });

        clearBtn.addEventListener('click', function () {
            codeInput.value = '';
            outputTerminal.innerHTML = '<span class="info-text">🧹 Console cleared. Ready for new code!</span>';
        });

        floatingHintBtn.addEventListener('click', toggleHintPanel);
        hintCloseBtn.addEventListener('click', closeHintPanel);

        // Close hint panel when clicking outside
        document.addEventListener('click', function(event) {
            if (!floatingHintBtn.contains(event.target) &&
                !floatingHintPanel.contains(event.target) &&
                floatingHintPanel.classList.contains('show')) {
                closeHintPanel();
            }
        });

        // Initialize the application on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', async function() {
            await populateSidebar();
            updateOutput("🚀 Initializing Python environment...", 'info');

            // Setup Pyodide
            await setupPyodide();

            // Load all chapter lesson counts initially to better estimate progress
            // This assumes 'exercises.json' exists and lists all chapters and their lessons.
            try {
                const res = await fetch('exercises.json');
                if (res.ok) {
                    const data = await res.json();
                    totalChapters = data.chapters.length;
                    data.chapters.forEach(c => {
                        maxLessonsPerChapter[c.id] = c.lessons.length;
                    });
                } else {
                    console.warn("exercises.json not found. Progress bar might be less accurate.");
                }
            } catch (e) {
                console.error("Error loading exercises.json:", e);
            }


            // Load first lesson
            const success = await loadLesson(currentChapter, currentLesson);
            if (success) {
                updateOutput("✅ Ready to start coding! Write your Python code and click Run.", 'success');
            } else {
                updateOutput("⚠️ Could not load the first lesson. Ensure 'exercises/chapter-1/lesson1.json' exists.", 'error');
            }

            console.log('Application initialized');
        });
    </script>
    <script>
        // Add these event listeners inside your DOMContentLoaded function
        document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
        document.getElementById('sidebarClose').addEventListener('click', closeSidebar);
        document.getElementById('sidebarOverlay').addEventListener('click', closeSidebar);

        // Populate sidebar
        
        // Sidebar functionality
let sidebarOpen = false;

/**
 * Toggles the sidebar open/closed
 */
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebarOverlay');
    const toggle = document.getElementById('sidebarToggle');
    
    sidebarOpen = !sidebarOpen;
    
    if (sidebarOpen) {
        sidebar.classList.add('open');
        overlay.classList.add('active');
        toggle.classList.add('active');
    } else {
        sidebar.classList.remove('open');
        overlay.classList.remove('active');
        toggle.classList.remove('active');
    }
}

/**
 * Closes the sidebar
 */
function closeSidebar() {
    if (sidebarOpen) {
        toggleSidebar();
    }
}

/**
 * Populates the sidebar with chapters and lessons
 */
async function populateSidebar() {
    const sidebarContent = document.getElementById('sidebarContent');
    let sidebarHTML = '';
    
    try {
        // Try to load from exercises.json first
        const res = await fetch('exercises.json');
        if (res.ok) {
            const data = await res.json();
            
            for (const chapter of data.chapters) {
                sidebarHTML += `
                    <div class="chapter-item">
                        <button class="chapter-header" onclick="toggleChapter(${chapter.id})">
                            <span>Chapter ${chapter.id}</span>
                            <span class="chapter-arrow">▶</span>
                        </button>
                        <div class="lessons-list" id="chapter-${chapter.id}-lessons">
                            ${chapter.lessons.map(lesson => `
                                <button class="lesson-item" onclick="navigateToLesson(${chapter.id}, ${lesson.id})">
                                    Lesson ${lesson.id}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        } else {
            throw new Error('exercises.json not found');
        }
    } catch (e) {
        // Fallback: Create sidebar based on maxLessonsPerChapter
        for (let chapterId = 1; chapterId <= totalChapters; chapterId++) {
            const lessonCount = maxLessonsPerChapter[chapterId] || 5;
            let lessonsHTML = '';
            
            for (let lessonId = 1; lessonId <= lessonCount; lessonId++) {
                lessonsHTML += `
                    <button class="lesson-item" onclick="navigateToLesson(${chapterId}, ${lessonId})">
                        Lesson ${lessonId}
                    </button>
                `;
            }
            
            sidebarHTML += `
                <div class="chapter-item">
                    <button class="chapter-header" onclick="toggleChapter(${chapterId})">
                        <span>Chapter ${chapterId}</span>
                        <span class="chapter-arrow">▶</span>
                    </button>
                    <div class="lessons-list" id="chapter-${chapterId}-lessons">
                        ${lessonsHTML}
                    </div>
                </div>
            `;
        }
    }
    
    sidebarContent.innerHTML = sidebarHTML + `
    <div class="chapter-item">
        <button class="chapter-header" onclick="window.location.href='tasks.html'">
            <span>📝 Tasks</span>
        </button>
    </div>
    `;
    updateSidebarActiveStates();
}

/**
 * Toggles a chapter dropdown in the sidebar
 */
function toggleChapter(chapterId) {
    const header = document.querySelector(`button[onclick="toggleChapter(${chapterId})"]`);
    const lessonsList = document.getElementById(`chapter-${chapterId}-lessons`);
    
    const isExpanded = lessonsList.classList.contains('expanded');
    
    if (isExpanded) {
        lessonsList.classList.remove('expanded');
        header.classList.remove('expanded');
    } else {
        lessonsList.classList.add('expanded');
        header.classList.add('expanded');
    }
}

/**
 * Navigates to a specific lesson
 */
async function navigateToLesson(chapter, lesson) {
    // Show loader
    showLessonLoader(chapter, lesson);
    
    // Simulate loading time
    await simulateLoading(1000);
    
    // Update current chapter and lesson
    currentChapter = chapter;
    currentLesson = lesson;
    
    // Load the lesson
    const success = await loadLesson(chapter, lesson);
    
    // Hide loader
    hideLessonLoader();
    
    if (success) {
        updateOutput(`✅ Loaded Chapter ${chapter}, Lesson ${lesson}`, 'success');
        updateSidebarActiveStates();
        closeSidebar();
    } else {
        updateOutput(`⚠️ Could not load Chapter ${chapter}, Lesson ${lesson}`, 'error');
    }
}

/**
 * Updates the active states in the sidebar
 */
function updateSidebarActiveStates() {
    // Remove all active states
    document.querySelectorAll('.chapter-header').forEach(header => {
        header.classList.remove('active');
    });
    document.querySelectorAll('.lesson-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Add active state to current chapter
    const currentChapterHeader = document.querySelector(`button[onclick="toggleChapter(${currentChapter})"]`);
    if (currentChapterHeader) {
        currentChapterHeader.classList.add('active');
        
        // Expand current chapter
        const lessonsList = document.getElementById(`chapter-${currentChapter}-lessons`);
        if (lessonsList) {
            lessonsList.classList.add('expanded');
            currentChapterHeader.classList.add('expanded');
        }
    }
    
    // Add active state to current lesson
    const currentLessonItem = document.querySelector(`button[onclick="navigateToLesson(${currentChapter}, ${currentLesson})"]`);
    if (currentLessonItem) {
        currentLessonItem.classList.add('active');
    }
}
    </script>
</body>
</html>
